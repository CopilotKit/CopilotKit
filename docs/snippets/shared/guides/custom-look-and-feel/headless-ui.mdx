import { ImageAndCode } from "@/components/react/image-and-code"

## Overview

CopilotKit offers *fully headless UI* through the `useCopilotChatHeadless_c` hook. By using this hook, you can build your own chat interfaces
from the ground up while still utilizing CopilotKit's core features and ease-of-use.

<Callout title="This is a premium-only feature">
Sign up for free on [Copilot Cloud](https://cloud.copilotkit.ai) to get your public license key.

Usage is generous, **free** to get started, and works with **either self-hosted or Copilot Cloud** environments.
</Callout>

## Reference
This page is entirely focused on practical examples and usage. For reference documentation, see the [reference](/reference/hooks/useCopilotChatHeadless_c) page.

## Building a chat interface
To get started, let's walk through building a simple chat interface. From there, we'll cover
how to do more advanced things like working with suggestions and generative UI.

<Steps>
  <Step>
    ### Create a new application
    ```bash
    npx copilotkit@latest create
    ```
  </Step>

  <Step>
    ### Set up your application
    First, follow the instructions in the README to set up your application, it should be a simple process.

    ```bash
    open README.md
    ```
  </Step>

  <Step>
    ### Create a new Chat component
    Now, create a new component that will be used to render the chat interface.

    ```bash
    touch src/app/components/chat.tsx
    ```

    ```tsx title="src/app/page.tsx"
    import { CopilotKit, useCopilotChatHeadless_c } from "@copilotkit/react-core";
    ```

    You will also need to provide your public license key to the `CopilotKit` component.

    ```tsx title="src/app/layout.tsx"
    <CopilotKit publicApiKey="your-free-public-license-key">
      <YourComponent />
    </CopilotKit>
    ```
  </Step>

  <Step>
    ### Build a simple chat interface
    Now, create a new component that will be used to render the chat interface.

    ```tsx title="src/app/components/chat.tsx"
    import { useCopilotChatHeadless_c } from "@copilotkit/react-core";

    export const Chat = () => {
      const { messages, sendMessage, isLoading } = useCopilotChatHeadless_c();

      return (
        <div>
          {/* Render the messages */}
          {messages.map((message) => (
            <p key={message.id}>
              {message.role === "user" ? "User: " : "Assistant: "}
              {message.content}
            </p>
          ))}

          {/* Make an input for the user to type their message */}
          <input 
            type="text" 
            placeholder="Type your message here..."
            onKeyDown={(e) => {
              if (e.key === "Enter") {
                sendMessage({
                  id: "123",
                  role: "user",
                  content: (e.currentTarget as HTMLInputElement).value,
                });
              }
            }}
          />

          {/* Show a loading state */}
          {isLoading && <p>Loading...</p>}
        </div>
      );
    };
    ```
  </Step>
</Steps>

## Working with Generative UI

You can also render generative UI either via `useCopilotAction` or by reading tools and rendering them directly.

### With useCopilotAction
CopilotKit's standard components utilize `useCopilotAction` to allow tools to be both rendered and called in 
the frontend. These same interfaces are available to you while using the `useCopilotChatHeadless_c` hook.

```tsx title="src/app/components/chat.tsx"
import { useCopilotAction } from "@copilotkit/react-core";

export const Chat = () => {
  // ...

  // Define an action that will show a custom component
  useCopilotAction({
    name: "showCustomComponent",
    handler: () => {
      return "Foo, Bar, Baz";
    },
    render: ({ result, args, status}) => {
      return <div style={{
        backgroundColor: "red",
        padding: "10px",
        borderRadius: "5px",
      }}>
        <p>Custom component</p>
        <p>Result: {result}</p>
        <p>Args: {JSON.stringify(args)}</p>
        <p>Status: {status}</p>
      </div>;
    }
  });

  // ...

  return <div>
    {messages.map((message) => (
      <p key={message.id}>
        {message.role === "user" ? "User: " : "Assistant: "}
        {message.content}
        {/* [!code highlight:2] */}
        {message.role === "assistant" && message.generativeUI?.()}
      </p>
    ))}
  </div>
};
```

### With raw data
If you don't want to use `useCopilotAction`, you can also render the raw data directly.

```tsx title="src/app/components/chat.tsx"
export const Chat = () => {
  // ...

  return <div>
    {messages.map((message) => (
      <p key={message.id}>
        {message.role === "user" ? "User: " : "Assistant: "}
        {message.content}
        {/* [!code highlight:6] */}
        {message.role === "assistant" && message.toolCalls?.map((toolCall) => (
          <p key={toolCall.id}>
            {toolCall.function.name}: {toolCall.function.arguments}
          </p>
        ))}
      </p>
    ))}
  </div>
};
```

## Working with suggestions

CopilotKit's suggestions are a way to provide your users with a list of suggestions to operate the chat with. When utilizing
Headless UI, you have full control over the lifecycle of these suggestions.


### Generating suggestions

You can generate suggestions by calling the `generateSuggestions` function.
```tsx title="src/app/components/chat.tsx"
import { useCopilotChatHeadless_c, useCopilotChatSuggestions } from "@copilotkit/react-core";

export const Chat = () => {
  // Specify what suggestions should be generated
  useCopilotChatSuggestions({
    instructions:
      "Suggest 5 interesting activities for programmers to do on their next vacation",
    maxSuggestions: 5,
  });

  // Grab relevant state from the headless hook
  const { suggestions, generateSuggestions, sendMessage } = useCopilotChatHeadless_c();

  // Generate suggestions when the component mounts
  useEffect(() => {
    generateSuggestions();
  }, []);

  // ...

  return <div>
    {suggestions.map((suggestion, index) => (
      <button 
        key={index} 
        onClick={() => sendMessage({ 
          id: "123", 
          role: "user", 
          content: suggestion.message
        })}
      >
        {suggestion.title}
      </button>
    ))}
  </div>
};
```

### Programmatically setting suggestions
If you want more deterministic control over the suggestions, you can set them manually.

```tsx title="src/app/components/chat.tsx"
import { useCopilotChatHeadless_c } from "@copilotkit/react-core";

export const Chat = () => {
  // Grab relevant state from the headless hook
  const { suggestions, setSuggestions } = useCopilotChatHeadless_c();

  // Set the suggestions when the component mounts
  useEffect(() => {
    setSuggestions([
      { title: "Suggestion 1", message: "The actual message for suggestion 1" },
      { title: "Suggestion 2", message: "The actual message for suggestion 2" },
    ]);
  }, []);

  // Change the suggestions on function call
  const changeSuggestions = () => {
    setSuggestions([
      { title: "Foo", message: "Bar" },
      { title: "Baz", message: "Bat" },
    ]);
  };

  return (
    <div>
      {/* Change suggestions on button click */}
      <button onClick={changeSuggestions}>Change suggestions</button>

      {/* Render the suggestions */}
      {suggestions.map((suggestion, index) => (
        <button 
          key={index} 
          onClick={() => sendMessage({ 
            id: "123", 
            role: "user", 
            content: suggestion.message
          })}
        >
          {suggestion.title}
        </button>
      ))}
    </div>
  );
};
```

## Working with Human-in-the-loop

CopilotKit's human-in-the-loop (HITL) features allows you to pause the chat and wait for a human to respond. This comes 
in two flavors: **tool-based** and **interrupt-based** (for certain frameworks).

### Tool-based
Tool-based HITL allows for you to pause completion of a tool call and wait for a human to respond. That human's response,
becomes the result of the tool call.


```tsx title="src/app/components/chat.tsx"
import { useCopilotAction, useCopilotChatHeadless_c } from "@copilotkit/react-core";

export const Chat = () => {
  const { messages, sendMessage } = useCopilotChatHeadless_c();

  // Define an action that will wait for the user to enter their name
  useCopilotAction({
    name: "getName",
    renderAndWaitForResponse: ({ respond, args, status}) => {
      if (status === "complete") {
        return <div>
          <p>Name retrieved...</p>
        </div>;
      }

      return <div>
        <input 
          type="text" 
          value={args.name || ""} 
          onChange={(e) => respond?.(e.target.value)} 
          placeholder="Enter your name" 
        />
        <button onClick={() => respond?.(args.name)}>Submit</button>
      </div>;
    }
  });

  return (
    {messages.map((message) => (
      <p key={message.id}>
        {message.role === "user" ? "User: " : "Assistant: "}
        {message.content}
        {/* [!code highlight:3] */}
        {/* This will render the tool-based HITL if it exists */}
        {message.role === "assistant" && message.generativeUI?.()}
      </p>
    ))}
  )
};
```

