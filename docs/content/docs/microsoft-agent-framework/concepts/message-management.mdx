---
title: Message flow
icon: lucide/MessageCircle
---

Message management in agents operates with CopilotKit as the "ground truth" for the full chat session. 
When an agent session begins, it receives the existing CopilotKit chat history to maintain conversational
continuity across different agents.

<Callout>
While all of this information is great to know, in most cases you won't need to worry about these details to
build rich agentic applications. Use the information here as a reference when getting really deep into 
the agent internals.
</Callout>

### Can I modify the message history?

In Microsoft Agent Framework, message history is managed through the `AgentThread`. Messages are automatically appended to the thread during agent execution. To implement custom message management:

- Use a custom `ChatMessageStore` to control message storage and retrieval
- Implement message filtering or summarization in `GetMessagesAsync()` 
- Manage thread state externally for fine-grained control

See [Message Persistence](/microsoft-agent-framework/persistence/message-persistence) for implementing custom message storage patterns.

<Callout type="info">
  Message editing from the frontend is not currently supported but may be added in future releases.
</Callout>

### Can I persist chat history?

Yes! There are a few ways to persist various portions of a chat's history:
- [Threads](/microsoft-agent-framework/persistence/threads)
- [Message Persistence](/microsoft-agent-framework/persistence/message-persistence)
- [Agent State](/microsoft-agent-framework/persistence/loading-agent-state)

## Types of LLM Messages

Modern LLM interactions produce two distinct types of messages:

1. **Communication Messages**: Direct responses and interactions with users
2. **Internal Messages**: Agent "thoughts" and reasoning processes

A well known example of this pattern is OpenAI's o1 model, which has sophisticated reasoning capabilities and thoughts. Its internal
thought processes are presented distinctly from 'communication messages' which are clearly visible to the end-user.

Microsoft Agent Framework agents operate similarly. Messages can be communication-focused or represent internal reasoning.

### Streaming Messages During Execution

For long-running tasks, you may want to provide user feedback. Microsoft Agent Framework supports streaming responses through the AG-UI protocol. Messages are automatically streamed to the frontend as your agent processes them.

```csharp
// Messages are automatically streamed via AG-UI SSE (Server-Sent Events)
// as the agent generates responses. No special emission code needed.

var agent = client.GetChatClient(deployment)
    .CreateAIAgent(
        name: "StreamingAgent",
        instructions: "You are a helpful assistant. Provide detailed explanations."
    );

// Streaming happens automatically through the AG-UI protocol
```

For more advanced message streaming scenarios, see our guide on [emitting messages](/microsoft-agent-framework/advanced/emit-messages).

## Message Flow

Messages flow between CopilotKit and Microsoft Agent Framework in a specific way:

- All messages from the agent are streamed to CopilotKit via the AG-UI protocol
- On each agent invocation, the full CopilotKit chat history is provided to the agent via the `messages` parameter
- When an agent completes execution, its messages become part of CopilotKit's persistent chat history

This ensures conversational continuity - each agent invocation has access to the complete conversation context.
