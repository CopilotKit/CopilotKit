---
title: "Exiting the agent loop"
icon: "lucide/DoorOpen"
description: "Understanding how Microsoft Agent Framework agents complete execution"
---

## What is this?

Microsoft Agent Framework agents execute in a request-response model via AG-UI. Each agent invocation processes messages and returns a response, then completes. There's no persistent "agent loop" to exit - each run is independent.

## How Agent Execution Works

```csharp
app.MapAGUIAgent("/", (RunAgentInput agentInput, HttpContext httpContext) =>
{
    // Agent is created per-request
    var client = new AzureOpenAIClient(new Uri(endpoint), new DefaultAzureCredential());
    var chatClient = client.GetChatClient(deployment).AsIChatClient();
    var agent = new ChatClientAgent(chatClient, name: "Assistant");
    
    // Agent processes messages and completes automatically
    return new ChatClientAGUIAgent(agent);
});
```

**Execution flow:**
1. Frontend sends messages to AG-UI endpoint
2. Agent is created and processes the request
3. Response is streamed back via SSE
4. Agent run completes automatically
5. Next user message creates a new agent run

<Callout type="info">
  Unlike LangGraph's stateful graph loops, MAF agents follow a simpler request-response pattern. Each run is self-contained and completes when the response is generated.
</Callout>

## Multi-Turn Conversations

For multi-turn conversations, use `AgentThread` to maintain context across requests:

```csharp
// Thread persistence is handled by CopilotKit's threadId
// Each new request includes the full conversation history
// The agent processes it and adds its response to the thread
```

See [Persistence - Threads](/microsoft-agent-framework/persistence/loading-message-history) for managing conversation continuity.

## Agent Mode Behavior

- **Router Mode**: After completing a response, the router can invoke other agents or actions based on user input
- **Agent Lock Mode**: All requests are directed to the same agent

These modes are configured in CopilotKit, not in your agent code. The agent simply processes messages and completes.
