---
title: "Connect to MCP Servers"
description: "Integrate Model Context Protocol (MCP) servers with your existing React application for enhanced AI capabilities"
icon: "lucide/Network"
---

import Link from "next/link";
import { Database, Code, Server, Bot } from "lucide-react";

<Callout type="info" title="Are you new to CopilotKit?">
  Check out our [Quickstart Guide](https://docs.copilotkit.ai/quickstart) for
  more details.
</Callout>

## What is Model Context Protocol (MCP)?

The Model Context Protocol is an open standard that enables developers to build secure, two-way connections between their data sources and AI-powered tools. With MCP, you can:

- Connect AI applications to your data sources
- Enable AI tools to access and utilize your data securely
- Build AI-powered features that have context about your application

## Setup MCP with CopilotKit

<Callout type="info" title="Get a Public API Key (Optional)">
  Sign up for a free <LinkToCopilotCloud asButton={false}>Copilot Cloud</LinkToCopilotCloud> account to get a public API key, or <Link href="/guides/model-context-protocol#self-hosting">self host the runtime</Link>.
</Callout>

### Quick Setup in Existing Next.js App

The fastest way to add MCP support to an existing Next.js application is by using the CopilotKit CLI:

```bash
npx cpk init --mcp --mcpServerUrl="<your_mcp_server_url>"
```

This command will:

- Add necessary CopilotKit dependencies
- Set up MCP integration with your specified server URL
- Create basic components to get you started

### Manual Setup: Step by Step

For more control over the integration, follow these steps:

#### Step 1: Set up the CopilotKit Provider

Wrap your application with the `CopilotKit` provider:

```tsx
"use client";

import { CopilotKit } from "@copilotkit/react-core";

export default function App() {
  return (
    <CopilotKit publicApiKey="<replace_with_your_own>">
      {/* Your app content */}
    </CopilotKit>
  );
}
```

#### Step 2: Connect to MCP Servers

Create a component to manage MCP server connections:

```tsx
"use client";

import { useCopilotChat } from "@copilotkit/react-ui";
import { useEffect } from "react";

function McpServerManager() {
  const { setMcpServers } = useCopilotChat();

  useEffect(() => {
    setMcpServers([
      {
        // Try a sample MCP server at https://mcp.composio.dev/
        endpoint: "your_mcp_sse_url",
      },
    ]);
  }, [setMcpServers]);

  return null;
}

export default McpServerManager;
```

#### Step 3: Add the Chat Interface

Add the `CopilotChat` component to your page:

```tsx
"use client";

import { CopilotChat } from "@copilotkit/react-ui";
import McpServerManager from "./McpServerManager";

export default function ChatInterface() {
  return (
    <div className="flex h-screen p-4">
      <McpServerManager />
      <CopilotChat
        instructions="You are a helpful assistant with access to MCP servers."
        className="flex-grow rounded-lg w-full"
      />
    </div>
  );
}
```

#### Step 4: Visualize MCP Tool Calls (Optional)

Create a component to display MCP tool calls in your UI:

```tsx
"use client";

import {
  useCopilotAction,
  CatchAllActionRenderProps,
} from "@copilotkit/react-core";
import McpToolCall from "./McpToolCall";

export function ToolRenderer() {
  useCopilotAction({
    /**
     * The asterisk (*) matches all tool calls
     */
    name: "*",
    render: ({ name, status, args, result }: CatchAllActionRenderProps<[]>) => (
      <McpToolCall status={status} name={name} args={args} result={result} />
    ),
  });
  return null;
}
```

#### Step 5: Complete Implementation

Combine all components together:

```tsx
"use client";

import { CopilotKit } from "@copilotkit/react-core";
import { CopilotChat } from "@copilotkit/react-ui";
import McpServerManager from "./McpServerManager";
import { ToolRenderer } from "./ToolRenderer";

export default function Page() {
  return (
    <CopilotKit publicApiKey="<replace_with_your_own>">
      <div className="flex h-screen p-4">
        <McpServerManager />
        <CopilotChat
          instructions="You are a helpful assistant with access to MCP servers."
          className="flex-grow rounded-lg w-full"
        />
        <ToolRenderer />
      </div>
    </CopilotKit>
  );
}
```

## Implementing the McpToolCall Component

<details>
<summary>Click to see the McpToolCall component implementation</summary>

```tsx
"use client";

import * as React from "react";

interface ToolCallProps {
  status: "complete" | "inProgress" | "executing";
  name?: string;
  args?: any;
  result?: any;
}

export default function McpToolCall({
  status,
  name = "",
  args,
  result,
}: ToolCallProps) {
  const [isOpen, setIsOpen] = React.useState(false);

  // Format string with proper line breaks and quotes
  const formatContent = (str: string): string => {
    const text = typeof str !== "string" ? JSON.stringify(str, null, 2) : str;
    return text
      .replace(/\\n/g, "\n")
      .replace(/\\t/g, "\t")
      .replace(/\\"/g, '"')
      .replace(/\\\\/g, "\\");
  };

  // Format arguments and results
  const formattedArgs = React.useMemo(() => {
    if (!args) return "";
    return formatContent(
      typeof args === "object" ? JSON.stringify(args, null, 2) : args
    );
  }, [args]);

  const formattedResult = React.useMemo(() => {
    if (!result) return "";

    if (typeof result === "object" && result?.error?.message) {
      const copy = { ...result };
      copy.error = { ...copy.error };
      copy.error.message = formatContent(copy.error.message);
      return formatContent(JSON.stringify(copy, null, 2));
    }

    return formatContent(
      typeof result === "object" ? JSON.stringify(result, null, 2) : result
    );
  }, [result]);

  return (
    <div className="bg-[#1e2738] rounded-lg overflow-hidden w-full">
      <div
        className="p-3 flex items-center cursor-pointer"
        onClick={() => setIsOpen(!isOpen)}
      >
        <div className="min-w-0 flex-grow overflow-hidden">
          <span className="text-white text-sm">{name || "MCP Tool Call"}</span>
        </div>
        <div className="ml-auto">
          <div
            className={`w-2 h-2 rounded-full ${
              status === "complete"
                ? "bg-green-500"
                : status === "inProgress" || status === "executing"
                ? "bg-blue-500 animate-pulse"
                : ""
            }`}
          />
        </div>
      </div>

      {isOpen && (
        <div className="px-4 pb-4 text-gray-300 font-mono text-xs">
          {args && (
            <div className="mb-4">
              <div className="text-gray-400 mb-2">Parameters:</div>
              <pre className="whitespace-pre-wrap max-h-[200px] overflow-auto bg-transparent">
                {formattedArgs}
              </pre>
            </div>
          )}

          {status === "complete" && result && (
            <div>
              <div className="text-gray-400 mb-2">Result:</div>
              <pre className="whitespace-pre-wrap max-h-[200px] overflow-auto bg-transparent">
                {formattedResult}
              </pre>
            </div>
          )}
        </div>
      )}
    </div>
  );
}
```

</details>

## Self-Hosting Option

<details>
<summary>Click here to learn how to use MCP with self-hosted runtime</summary>

<Callout type="info" title="Self-Hosting vs Copilot Cloud">
  The Copilot Runtime handles communication with LLMs, message history, and
  state. You can self-host it or use{" "}
  <LinkToCopilotCloud asButton={false}>Copilot Cloud</LinkToCopilotCloud>{" "}
  (recommended). Learn more in our [Self-Hosting Guide](/guides/self-hosting).
</Callout>

Configure your self-hosted runtime with MCP servers (Next.js App Router example):

```tsx
import {
  CopilotRuntime,
  OpenAIAdapter,
  copilotRuntimeNextJSAppRouterEndpoint,
} from "@copilotkit/runtime";
import { experimental_createMCPClient } from "ai";
import { NextRequest } from "next/server";

const serviceAdapter = new OpenAIAdapter();

const runtime = new CopilotRuntime({
  mcpServers: [
    {
      endpoint: "your_mcp_sse_url", // Try https://mcp.composio.dev/
    },
  ],
  createMCPClient: async (config) => {
    return await experimental_createMCPClient({
      transport: {
        type: "sse",
        url: config.endpoint,
        headers: config.apiKey
          ? { Authorization: `Bearer ${config.apiKey}` }
          : undefined,
      },
    });
  },
});

export const POST = async (req: NextRequest) => {
  const { handleRequest } = copilotRuntimeNextJSAppRouterEndpoint({
    runtime,
    serviceAdapter,
    endpoint: "/api/copilotkit",
  });

  return handleRequest(req);
};
```

</details>

## What's Next?

<Cards>
  <Card
    title="Connect Your Data"
    href="/guides/connect-your-data/frontend"
    icon={<Database />}
  >
    Learn how to connect your data sources to enhance your AI assistant.
  </Card>
  <Card
    title="Frontend Actions"
    href="/coagents/frontend-actions"
    icon={<Code />}
  >
    Implement client-side actions for your AI assistant.
  </Card>
  <Card
    title="Backend Actions"
    href="/guides/backend-actions"
    icon={<Server />}
  >
    Create powerful server-side actions.
  </Card>
  <Card title="Bring Your Agent" href="/coagents" icon={<Bot />}>
    Integrate your existing agents with CopilotKit.
  </Card>
</Cards>
