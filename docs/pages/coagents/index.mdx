import { BiSolidMessage as TextIcon } from "react-icons/bi";
import { VscJson as JsonIcon } from "react-icons/vsc";
import { Frame, YouTubeVideo } from "@/components";
import { FaDiscord } from "react-icons/fa";
import Link from "next/link";
import { CoAgentsEnterpriseCTA } from "@/components/coagents-enterprise-cta";
import { CoAgentsFeatures } from "@/components";
import { Steps } from 'nextra/components'

# Introduction to CoAgents (Early Access)

<div className="flex justify-center my-12">
  <YouTubeVideo videoId="nBephBv4zr0" defaultPlaybackRate={1.25} />
</div>

<p className="text-xl/snug mb-0 font-medium">CopilotKit's CoAgents are the missing link that makes it easy to connect LangGraph agents to humans in the loop.</p>

As an industry, we are quickly learning that **AI agents perform best when they work alongside humans**. Working with machines to perform complex tasks with a human in the loop is far easier than teaching AIs to perform those tasks autonomously. But building good workflows to enable human-AI collaboration has been no small task â€” until now.

<p className="mt-6"><Link href="/coagents/coagent-demo" className="_text-primary-600 decoration-from-font underline [text-underline-position:from-font]">Check out a demo of a Perplexity clone, built with CoAgents</Link></p>

## The Core Features of a CoAgent

<CoAgentsFeatures.Toggle />

<CoAgentsFeatures.GenerativeUi>
  ### Generative UI

  Generative UI allows you to create dynamic user interfaces with AI-generated components, inside a chat UI.

  ```tsx
  useCoAgentAction({
    // the name of the agent 
    name: "car_rental_agent",
    
    // this is optional: the node name to render generative UI for. If left empty, renders for every node.
    nodeName: "confirm_node",
    
    // render can be a function or a string, just like useCopilotAction
    render: ({ state, status }) => {
      if (status === "inProgress") {
        return <div> Generating response: {state.response} </div>
      } else {
        return <div> Done generating response </div>
      }
    }
  });
  ```

</CoAgentsFeatures.GenerativeUi>

<CoAgentsFeatures.StreamAgentState>
  ### Stream agent state

  <Frame>
    <img src="/images/coagents/intermediate-state.gif" />
  </Frame>

  <Steps>
    ### Frontend

    All you need to do to get the current LangGraph agent state is call `useCoAgent`.

    ```tsx
    const { state } = useCoAgent({
      name: "search_agent", // the name of the agent
    });
    ```

    ### LangGraph
    The LangGraph state only updates when leaving a LangGraph node.
    If you want to stream state updates to the frontend as they are generated, you can do so by one of the following methods:

    #### Intercept tool calls

    If you would like to stream **intermediate** state to the frontend, you can do so by treating (streaming) tool call arguments as intermediate state:

    ```python
    # in python code:
    config = copilotkit_customize_config(
        config,
        emit_intermediate_state=[
            {
                "state_key": "steps", # key on the LangGraph state to be updated
                "tool": "search", # tool call 
                "tool_argument": "steps" # argument of the tool call interpreted as intermediate state
            },
        ]
    )

    # ...

    response = await ChatOpenAI(model="gpt-4").bind_tools([search_tool], parallel_tool_calls=False, tool_choice="search").ainvoke([
        *state["messages"],
        SystemMessage(
            content=system_message
        )
    ], config)
    ```

    #### Manually Emit State

    You can imperatively emit state by calling `copilotkit_emit_state`:

    ```python
    # imperative function:
    copilotkit_emit_state({"key": value}, config)
    ```
  </Steps>

</CoAgentsFeatures.StreamAgentState>

<CoAgentsFeatures.ShareAgentState>

  ### Share Agent State

  Sharing agent state allows for collaboration and persistence across different sessions or users. Here's how you can implement this feature:

  ```typescript
  const { state, setState, start, stop, run } = useCoAgent({
    name: "search_agent",
  });
  
  // ...
  setState(newStateEditedByUser)
  run("the user has updated the state") // optionally provide a hint about why the agent state changed.
  ```

  Just like before, we use the `state` variable on `useCoAgent` to receive the latest agent state.
  Now we additionally intercept 4 more of `useCoAgent`'s returned values:
  - `setState`: A function to update the agent's state manually
  - `start`: A function to initiate the agent's execution
  - `stop`: A function to halt the agent's execution
  - `run`: A function to re-run the agent, after updating the state. Optionally include a hint for why the state changed.


</CoAgentsFeatures.ShareAgentState>

<CoAgentsFeatures.AgentQAndA>
  ### Agent Q&A

  Agents can easily and intentionally ask the user questions. With support for:

- **Text Feedback:** Via the chat UI.
- **Structured (JSON) Feedback:** Via fully custom UI/UX anywhere in your application (chat UI, modals, popups, forms, etc).

<br />

<div className="flex gap-2 w-full my-2">
  <div className="flex-1 border bg-white rounded-lg shadow-md p-4">
    <div className="flex items-center justify-center gap-2 font-semibold">
      <div className="bg-indigo-500 rounded-md w-7 h-7 text-white flex items-center justify-center">
        <TextIcon className="w-4 h-4" />
      </div>
      <span>Text Feedback</span>
    </div>
    <div className="italic py-4">
      <img
        src="/images/coagents/text-feedback.png"
        className="rounded-md border"
      />
    </div>
  </div>
  <div className="flex-1 border bg-white rounded-lg shadow-md p-4">
    <div className="flex items-center justify-center gap-2 font-semibold">
      <div className="bg-indigo-500 rounded-md w-7 h-7 text-white flex items-center justify-center">
        <JsonIcon className="w-5 h-5" />
      </div>
      <span>Structured (JSON) Feedback</span>
    </div>
    <div className="italic py-4">
      <img
        src="/images/coagents/json-feedback.png"
        className="rounded-md border"
      />
    </div>
  </div>
</div>



</CoAgentsFeatures.AgentQAndA>

## Get started building with CoAgents

We've built a simple example with everything you need to get started:

```bash
git clone https://github.com/copilotkit/examples ./copilotkit-examples
cd ./copilotkit-examples/bootstrap

# Install Python dependencies
pip install -r requirements.txt

# Install JS dependencies
npm install

# Run the dev server!
npm run dev
```

Looking for more details, or want to integrate CoAgents into an existing application? <Link href="/coagents/getting-started" className="_text-primary-600 decoration-from-font underline [text-underline-position:from-font]">Check out our getting started guide</Link>.

<div className="flex justify-center mt-6 mb-12">
  <Link href="https://discord.gg/FsK9P2Nv" target="_blank">
    <button className="bg-indigo-600 text-white px-4 py-2 rounded-lg flex items-center gap-2 mt-2 font-medium">
      <FaDiscord className="w-4 h-4" />
      <span>Join our CoAgents channel on Discord</span>
    </button>
  </Link>
</div>

<CoAgentsEnterpriseCTA />
