{
  "$schema": "https://ui.shadcn.com/schema/registry-item.json",
  "name": "coagents-crew-starter",
  "type": "registry:page",
  "title": "Coagents Crew Starter",
  "description": "Quickstart for CopilotKit and CrewAI Crews on CrewAI Enterprise.",
  "dependencies": [
    "@copilotkit/react-core",
    "@copilotkit/runtime-client-gql"
  ],
  "files": [
    {
      "path": "hooks/use-coagents-crew-starter.tsx",
      "content": "\"use client\";\nimport {\n  CrewsAgentState,\n  CrewsResponseStatus,\n  useCoAgent,\n  useCoAgentStateRender,\n  useCopilotAction,\n  useCopilotAdditionalInstructions,\n  useCopilotChat,\n} from \"@copilotkit/react-core\";\nimport { useEffect, useState } from \"react\";\nimport CrewHumanFeedbackRenderer, {\n  CrewsFeedback,\n} from \"@/components/crews/crew-human-feedback-renderer\";\nimport CrewStateRenderer from \"@/components/crews/crew-state-renderer\";\nimport { MessageRole, TextMessage } from \"@copilotkit/runtime-client-gql\";\nimport { CrewInChatInput } from \"@/components/crews/crew-in-chat-input\";\n\n/**\n * Hook: useCoagentsCrewStarter\n *\n * This hook sets up a crew/agent and manages its lifecycle, including:\n * 1. Initializing the crew with a name and input fields.\n * 2. Handling user input through a form.\n * 3. Rendering the crew's real-time state.\n * 4. Managing feedback requests from the crew.\n *\n * @param {Object} params - Parameters for initializing the crew.\n * @param {string} params.crewName - The name of the crew.\n * @param {Array<string>} params.inputs - An array of input field names.\n * @returns {Object} - Contains the output result of the crew.\n */\nexport const useCoagentsCrewStarter = ({\n  crewName,\n  inputs,\n}: {\n  crewName: string;\n  inputs: Array<string>;\n}): {\n  output: string;\n} => {\n  const [initialMessageSent, setInitialMessageSent] = useState(false);\n\n  // Initialize the crew agent with a default state\n  const { state, setState, run } = useCoAgent<\n    CrewsAgentState & {\n      result: string;\n      inputs: Record<string, string>;\n    }\n  >({\n    name: crewName,\n    initialState: {\n      inputs: {},\n      result: \"Crew result will appear here...\",\n    },\n  });\n\n  const { appendMessage, isLoading } = useCopilotChat();\n\n  // Instructions for the copilot to ensure inputs are gathered before proceeding\n  const instructions =\n    \"INPUTS ARE ABSOLUTELY REQUIRED. Please call getInputs before proceeding with anything else.\";\n\n  // Effect to send an initial message when the chat is loaded\n  useEffect(() => {\n    if (initialMessageSent || isLoading) return;\n\n    setTimeout(async () => {\n      await appendMessage(\n        new TextMessage({\n          content: \"Hi, Please provide your inputs before we get started.\",\n          role: MessageRole.Developer,\n        })\n      );\n      setInitialMessageSent(true);\n    }, 0);\n  }, [initialMessageSent, isLoading, appendMessage]);\n\n  // Effect to send a message with the inputs once they are provided\n  useEffect(() => {\n    if (!initialMessageSent && Object.values(state?.inputs || {}).length > 0) {\n      appendMessage(\n        new TextMessage({\n          role: MessageRole.Developer,\n          content: \"My inputs are: \" + JSON.stringify(state?.inputs),\n        })\n      ).then(() => {\n        setInitialMessageSent(true);\n      });\n    }\n  }, [initialMessageSent, state?.inputs, appendMessage]);\n\n  // Provide additional instructions to the copilot\n  useCopilotAdditionalInstructions({\n    instructions,\n    available:\n      Object.values(state?.inputs || {}).length > 0 ? \"enabled\" : \"disabled\",\n  });\n\n  // Action to get inputs from the user\n  useCopilotAction({\n    name: \"getInputs\",\n    followUp: false,\n    description:\n      \"This action allows Crew to get required inputs from the user before starting the Crew.\",\n    renderAndWaitForResponse({ status }) {\n      if (status === \"inProgress\" || status === \"executing\") {\n        return (\n          <CrewInChatInput\n            status={status}\n            inputs={inputs}\n            onSubmit={async (inputValues) => {\n              setState({\n                ...state,\n                inputs: inputValues,\n              });\n              await run();\n            }}\n          />\n        );\n      }\n      return <>Inputs submitted</>;\n    },\n  });\n\n  // Render the crew's state in real-time\n  useCoAgentStateRender({\n    name: crewName,\n    render: ({ state, status }) => (\n      <CrewStateRenderer state={state} status={status} />\n    ),\n  });\n\n  // Action to handle feedback requests from the crew\n  useCopilotAction({\n    name: \"crew_requesting_feedback\",\n    description: \"Request feedback from the user\",\n    renderAndWaitForResponse(props) {\n      const { status, args, respond } = props;\n      return (\n        <CrewHumanFeedbackRenderer\n          feedback={args as unknown as CrewsFeedback}\n          respond={respond}\n          status={status as CrewsResponseStatus}\n        />\n      );\n    },\n  });\n\n  // Return the output result of the crew\n  return {\n    output: state?.result || \"\",\n  };\n};\n",
      "type": "registry:hook",
      "target": "hooks/use-coagents-crew-starter.tsx"
    },
    {
      "path": "components/crews/crew-in-chat-input.tsx",
      "content": "import React from \"react\";\n\ninterface CrewInChatInputProps {\n  status: \"inProgress\" | \"executing\" | string;\n  inputs: string[];\n  onSubmit: (inputs: Record<string, string>) => Promise<void>;\n}\n\n/**\n * A form component that renders dynamic input fields for crew interactions.\n * Used to collect user inputs during crew execution in a chat-like interface.\n *\n * @example\n * ```tsx\n * <CrewInChatInput\n *   status=\"inProgress\"\n *   inputs={[\"query\", \"context\"]}\n *   onSubmit={handleSubmit}\n * />\n * ```\n */\nexport const CrewInChatInput: React.FC<CrewInChatInputProps> = ({\n  status,\n  inputs,\n  onSubmit,\n}) => {\n  if (status !== \"inProgress\" && status !== \"executing\") {\n    return <>Inputs submitted</>;\n  }\n\n  return (\n    <form\n      style={{ display: \"flex\", flexDirection: \"column\", gap: \"16px\" }}\n      onSubmit={async (e: React.FormEvent<HTMLFormElement>) => {\n        e.preventDefault();\n        const formData = new FormData(e.currentTarget);\n        const inputValues = Object.fromEntries(\n          inputs.map((input) => [input, formData.get(input)?.toString() || \"\"])\n        );\n\n        await onSubmit(inputValues);\n      }}\n    >\n      <div style={{ display: \"flex\", flexDirection: \"column\", gap: \"16px\" }}>\n        {inputs.map((input) => (\n          <div\n            key={input}\n            style={{\n              display: \"flex\",\n              flexDirection: \"column\",\n              gap: \"8px\",\n            }}\n          >\n            <label htmlFor={input}>{input}</label>\n            <textarea\n              id={input}\n              name={input}\n              autoFocus\n              placeholder={`Enter ${input} here`}\n              required\n            />\n          </div>\n        ))}\n        <button\n          type=\"submit\"\n          style={{\n            cursor: \"pointer\",\n          }}\n        >\n          Submit\n        </button>\n      </div>\n    </form>\n  );\n};\n",
      "type": "registry:component",
      "target": "components/crews/crew-in-chat-input.tsx"
    },
    {
      "path": "components/crews/crew-state-renderer.tsx",
      "content": "import {\n  CrewsAgentState,\n  CrewsResponseStatus,\n  CrewsTaskStateItem,\n  CrewsToolStateItem,\n} from \"@copilotkit/react-core\";\nimport { useEffect } from \"react\";\nimport { useMemo, useRef, useState } from \"react\";\n\n/**\n * Renders your Crew's steps & tasks in real-time.\n */\nfunction CrewStateRenderer({\n  state,\n  status,\n}: {\n  state: CrewsAgentState;\n  status: CrewsResponseStatus;\n}) {\n  const [isCollapsed, setIsCollapsed] = useState(true);\n  const contentRef = useRef<HTMLDivElement>(null);\n  const prevItemsLengthRef = useRef<number>(0);\n  const [highlightId, setHighlightId] = useState<string | null>(null);\n\n  // Combine steps + tasks\n  const items = useMemo(() => {\n    if (!state) return [];\n    return [...(state.steps || []), ...(state.tasks || [])].sort(\n      (a, b) =>\n        new Date(a.timestamp).getTime() - new Date(b.timestamp).getTime()\n    );\n  }, [state]);\n\n  // Highlight newly added item & auto-scroll\n  useEffect(() => {\n    if (!state) return;\n    if (items.length > prevItemsLengthRef.current) {\n      const newestItem = items[items.length - 1];\n      setHighlightId(newestItem.id);\n      setTimeout(() => setHighlightId(null), 1500);\n\n      if (contentRef.current && !isCollapsed) {\n        contentRef.current.scrollTop = contentRef.current.scrollHeight;\n      }\n    }\n    prevItemsLengthRef.current = items.length;\n  }, [items, isCollapsed, state]);\n\n  if (!state) {\n    return <div>Loading crew state...</div>;\n  }\n\n  // Hide entirely if collapsed & empty & not in progress\n  if (isCollapsed && items.length === 0 && status !== \"inProgress\") return null;\n\n  return (\n    <div style={{ marginTop: \"8px\", fontSize: \"0.9rem\" }}>\n      <div\n        style={{ cursor: \"pointer\", display: \"flex\", alignItems: \"center\" }}\n        onClick={() => setIsCollapsed(!isCollapsed)}\n      >\n        <span style={{ marginRight: 4 }}>{isCollapsed ? \"▶\" : \"▼\"}</span>\n        {status === \"inProgress\" ? \"Crew is analyzing...\" : \"Crew analysis\"}\n      </div>\n\n      {!isCollapsed && (\n        <div\n          ref={contentRef}\n          style={{\n            maxHeight: \"200px\",\n            overflow: \"auto\",\n            borderLeft: \"1px solid #ccc\",\n            paddingLeft: \"8px\",\n            marginLeft: \"4px\",\n            marginTop: \"4px\",\n          }}\n        >\n          {items.length > 0 ? (\n            items.map((item) => {\n              const isTool = (item as CrewsToolStateItem).tool !== undefined;\n              const isHighlighted = item.id === highlightId;\n              return (\n                <div\n                  key={item.id}\n                  style={{\n                    marginBottom: \"8px\",\n                    animation: isHighlighted ? \"fadeIn 0.5s\" : undefined,\n                  }}\n                >\n                  <div style={{ fontWeight: \"bold\" }}>\n                    {isTool\n                      ? (item as CrewsToolStateItem).tool\n                      : (item as CrewsTaskStateItem).name}\n                  </div>\n                  {\"thought\" in item && item.thought && (\n                    <div style={{ opacity: 0.8, marginTop: \"4px\" }}>\n                      Thought: {item.thought}\n                    </div>\n                  )}\n                  {\"result\" in item && item.result !== undefined && (\n                    <pre style={{ fontSize: \"0.85rem\", marginTop: \"4px\" }}>\n                      {JSON.stringify(item.result, null, 2)}\n                    </pre>\n                  )}\n                  {\"description\" in item && item.description && (\n                    <div style={{ marginTop: \"4px\" }}>{item.description}</div>\n                  )}\n                </div>\n              );\n            })\n          ) : (\n            <div style={{ opacity: 0.7 }}>No activity yet...</div>\n          )}\n        </div>\n      )}\n\n      {/* Simple fadeIn animation */}\n      <style>{`\n        @keyframes fadeIn {\n          0% { opacity: 0; transform: translateY(4px); }\n          100% { opacity: 1; transform: translateY(0); }\n        }\n      `}</style>\n    </div>\n  );\n}\n\nexport default CrewStateRenderer;\n",
      "type": "registry:component",
      "target": "components/crews/crew-state-renderer.tsx"
    },
    {
      "path": "components/crews/crew-human-feedback-renderer.tsx",
      "content": "import { CrewsResponseStatus, CrewsStateItem } from \"@copilotkit/react-core\";\nimport { useState } from \"react\";\n\nexport interface CrewsFeedback extends CrewsStateItem {\n  /**\n   * Output of the task execution\n   */\n  task_output?: string;\n}\n\n/**\n * Renders a simple UI for agent-requested user feedback (Approve / Reject).\n */\nfunction CrewHumanFeedbackRenderer({\n  feedback,\n  respond,\n  status,\n}: {\n  feedback: CrewsFeedback;\n  respond?: (input: string) => void;\n  status: CrewsResponseStatus;\n}) {\n  const [isExpanded, setIsExpanded] = useState(true);\n  const [userResponse, setUserResponse] = useState<string | null>(null);\n\n  if (status === \"complete\") {\n    return (\n      <div style={{ marginTop: 8, textAlign: \"right\" }}>\n        {userResponse || \"Feedback submitted.\"}\n      </div>\n    );\n  }\n\n  if (status === \"inProgress\" || status === \"executing\") {\n    return (\n      <div style={{ marginTop: 8 }}>\n        {isExpanded && (\n          <div\n            style={{\n              border: \"1px solid #ddd\",\n              padding: \"8px\",\n              marginBottom: \"8px\",\n            }}\n          >\n            {feedback.task_output}\n          </div>\n        )}\n        <div style={{ textAlign: \"right\" }}>\n          <button\n            style={{ marginRight: 8 }}\n            onClick={() => setIsExpanded(!isExpanded)}\n          >\n            {isExpanded ? \"Hide\" : \"Show\"} Feedback\n          </button>\n          <button\n            style={{\n              marginRight: 8,\n              backgroundColor: \"#222222\",\n              border: \"none\",\n              padding: \"8px 16px\",\n              color: \"white\",\n              cursor: \"pointer\",\n              borderRadius: \"4px\",\n            }}\n            onClick={() => {\n              setUserResponse(\"Approved\");\n              /**\n               * This string is arbitrary. It can be any serializable input that will be forwarded to your Crew as feedback.\n               */\n              respond?.(\"Approve\");\n            }}\n          >\n            Approve\n          </button>\n          <button\n            style={{\n              backgroundColor: \"#222222\",\n              border: \"none\",\n              padding: \"8px 16px\",\n              color: \"white\",\n              cursor: \"pointer\",\n              borderRadius: \"4px\",\n            }}\n            onClick={() => {\n              setUserResponse(\"Rejected\");\n              /**\n               * This string is arbitrary. It can be any serializable input that will be forwarded to your Crew as feedback.\n               */\n              respond?.(\"Reject\");\n            }}\n          >\n            Reject\n          </button>\n        </div>\n      </div>\n    );\n  }\n\n  return null;\n}\n\nexport default CrewHumanFeedbackRenderer;\n",
      "type": "registry:component",
      "target": "components/crews/crew-human-feedback-renderer.tsx"
    },
    {
      "path": "components/layout/coagents-crew-starter-layout.tsx",
      "content": "\"use client\";\nimport React from \"react\";\nimport { CopilotChat } from \"@copilotkit/react-ui\";\n\nexport default function CoagentsCrewStarterLayout({\n  children,\n}: {\n  children: React.ReactNode;\n}) {\n  return (\n    <div className=\"w-full h-full relative\">\n      <div className=\"flex w-full h-full\">\n        {/* Chat Column */}\n        <div className=\"w-3/5 h-full overflow-y-auto\">\n          <CopilotChat\n            instructions=\"You are a helpful assistant that can help me with my tasks.\"\n            className=\"h-full flex flex-col\"\n          />\n        </div>\n\n        {/* Results Column */}\n        <div className=\"w-2/5 h-full overflow-y-auto bg-gray-50 dark:bg-gray-900 p-3\">\n          {children}\n        </div>\n      </div>\n    </div>\n  );\n}\n",
      "type": "registry:component",
      "target": "app/crew-quickstart/layout.tsx"
    },
    {
      "path": "components/quickstarts/coagents-crew-starter.tsx",
      "content": "\"use client\";\nimport React from \"react\";\nimport { useCoagentsCrewStarter } from \"@/hooks/use-coagents-crew-starter\";\n\n// Utility method for cleaning output from Crew, for demonstration purposes only\nfunction formatText(text: string): string {\n  if (!text) return \"\";\n\n  // First check if text already has formatting (multiple consecutive newlines)\n  const hasFormatting = /\\n\\s*\\n/.test(text);\n\n  // Process markdown elements first\n  let formatted = text;\n\n  // Convert markdown bold (**text**) to HTML bold\n  formatted = formatted.replace(/\\*\\*([^*]+)\\*\\*/g, \"<strong>$1</strong>\");\n\n  if (hasFormatting) {\n    // Just convert newlines to <br> tags for pre-formatted text\n    return formatted.replace(/\\n/g, \"<br>\");\n  } else {\n    // For unformatted text, add proper spacing\n    // Add double line breaks before restaurant entries (already converted to HTML)\n    formatted = formatted.replace(/(<strong>\\d+\\.)/g, \"<br><br>$1\");\n\n    // Add single line breaks before each property\n    formatted = formatted.replace(/(\\s-\\s<strong>)/g, \"<br>$1\");\n\n    return formatted;\n  }\n}\n\nexport default function CoagentsCrewStarter() {\n  const { output } = useCoagentsCrewStarter({\n    crewName: process.env.NEXT_PUBLIC_CREW_NAME!,\n    /**\n     * List of inputs needed to start your crew (e.g., location).\n     * This creates a form in the chat for the user to fill out.\n     * When submitted, the inputs are passed to the crew.\n     */\n    inputs: [\"YOUR_INPUT\"],\n  });\n  return (\n    <div className=\"text-sm text-gray-700 dark:text-gray-300 bg-white dark:bg-gray-800 rounded-md shadow-sm p-4 h-[calc(100%-2rem)] overflow-y-auto whitespace-pre-line\">\n      <div dangerouslySetInnerHTML={{ __html: formatText(output) }} />\n    </div>\n  );\n}\n",
      "type": "registry:page",
      "target": "app/crew-quickstart/page.tsx"
    }
  ]
}